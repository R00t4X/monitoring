# 🖥️ Система мониторинга серверов

[![Python](https://img.shields.io/badge/Python-3.7+-blue.svg)](https://www.python.org/downloads/)
[![Flask](https://img.shields.io/badge/Flask-2.0+-green.svg)](https://flask.palletsprojects.com/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

Современная веб-система для мониторинга серверов через SSH с автоматическим сбором метрик и удобным веб-интерфейсом.

## ✨ Возможности

- 🌍 **Публичный просмотр** - Пользователи могут просматривать статус серверов без авторизации
- 🔧 **Админ-панель** - Полное управление серверами (добавление, редактирование, удаление)
- 📊 **SSH мониторинг** - Сбор метрик через SSH (CPU, память, диск, uptime)
- ⏰ **Автоматический сбор** - Планировщик с настраиваемым интервалом
- 📈 **История метрик** - Сохранение и визуализация исторических данных
- 🚀 **REST API** - Программный доступ к данным
- 📱 **Адаптивный интерфейс** - Современный Bootstrap UI

## 🚀 Быстрый старт

### Автоматическая установка и запуск

```bash
# Клонируйте репозиторий
git clone <repository-url>
cd monitoring

# Запустите (автоматически установит зависимости)
python3 run.py
```

Приложение будет доступно по адресу: **http://127.0.0.1:5001**

### Ручная установка

```bash
# Создание виртуального окружения (рекомендуется)
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# или venv\Scripts\activate  # Windows

# Установка зависимостей
pip install -r requirements.txt

# Запуск
python3 run.py
```

## 🔐 Доступ к админ-панели

Для доступа к административной панели:

1. Откройте: **http://127.0.0.1:5001/admin**
2. **Учетные данные**: См. файл `ADMIN_CREDENTIALS.txt`

⚠️ **Важно**: Измените пароль администратора перед использованием в продакшене!

## 📁 Структура проекта

```
monitoring/
├── 📂 src/
│   ├── 🐍 app.py                 # Основное Flask приложение
│   └── 📂 core/
│       ├── 🗄️ database.py        # Управление базой данных
│       ├── 🔌 ssh_monitor.py     # SSH мониторинг серверов
│       ├── 📊 system_monitor.py  # Локальный мониторинг
│       └── ⏰ monitor_scheduler.py # Планировщик задач
├── 📂 templates/              # HTML шаблоны (Bootstrap)
├── 📂 data/                   # База данных SQLite
├── 📋 requirements.txt        # Python зависимости
├── 🚀 run.py                 # Скрипт запуска с автоустановкой
└── 🔒 ADMIN_CREDENTIALS.txt   # Учетные данные админа
```

## 🌐 Маршруты и API

### Публичные страницы
| URL | Описание |
|-----|----------|
| `/` | 🏠 Главная страница с навигацией |
| `/servers` | 📋 Список серверов (только просмотр) |
| `/servers/{id}` | 📊 Детальная информация о сервере |
| `/system` | 💻 Локальные метрики системы |

### Административная панель
| URL | Описание |
|-----|----------|
| `/admin` | 🎛️ Дашборд администратора |
| `/admin/servers` | ⚙️ Управление серверами |
| `/admin/servers/add` | ➕ Добавление нового сервера |
| `/admin/servers/{id}/edit` | ✏️ Редактирование сервера |

### REST API
| Endpoint | Метод | Описание |
|----------|-------|----------|
| `/api/servers` | GET | 📋 Список всех серверов |
| `/api/metrics` | GET | 📊 Локальные метрики |
| `/api/servers/{id}/metrics` | GET | 📈 История метрик сервера |
| `/api/servers/{id}/status` | GET | 🔄 Текущий статус сервера |

## ➕ Добавление серверов

1. 🔐 Войдите в административную панель
2. 📋 Перейдите в "Управление серверами"
3. ➕ Нажмите "Добавить сервер"
4. 📝 Заполните данные:
   - **Имя**: Отображаемое имя сервера
   - **IP/Хост**: IP адрес или доменное имя
   - **Порт**: SSH порт (по умолчанию 22)
   - **Пользователь**: SSH пользователь
   - **Аутентификация**: Пароль или SSH ключ

### 🔐 Настройка SSH аутентификации

#### По паролю
```bash
# Просто укажите пароль в веб-форме
```

#### По SSH ключу (рекомендуется)
```bash
# 1. Сгенерируйте ключ
ssh-keygen -t rsa -b 4096 -f ~/.ssh/monitoring_key

# 2. Скопируйте на сервер
ssh-copy-id -i ~/.ssh/monitoring_key.pub user@server

# 3. В веб-форме укажите путь к приватному ключу
# Путь: /home/user/.ssh/monitoring_key
```

## ⚙️ Конфигурация

### Изменение порта приложения
```python
# В файле src/app.py
app.run(host='127.0.0.1', port=ВАШЕ_ЗНАЧЕНИЕ, debug=True)
```

### Настройка интервала мониторинга
- 🌐 Через админ-панель: `/admin` → "Настройки мониторинга"
- 📝 В коде: `src/core/monitor_scheduler.py` → `DEFAULT_INTERVAL`

### 🔒 Безопасность
1. 🔑 Измените пароль администратора
2. 🌐 Используйте HTTPS в продакшене
3. 🔥 Настройте файрвол
4. 🔄 Регулярно обновляйте SSH ключи
5. 📝 Не коммитьте `ADMIN_CREDENTIALS.txt` в Git

## 📋 Системные требования

- 🐍 **Python**: 3.7 или выше
- 🗄️ **SQLite**: 3.x (встроен в Python)
- 🔌 **SSH доступ** к мониторируемым серверам
- 💾 **ОЗУ**: минимум 256 МБ
- 💿 **Диск**: 100 МБ свободного места

## 📦 Зависимости

| Пакет | Версия | Назначение |
|-------|--------|------------|
| Flask | 2.0+ | Веб-фреймворк |
| paramiko | 2.8+ | SSH клиент |
| psutil | 5.8+ | Системные метрики |

## 🔧 Устранение неполадок

### ❌ Ошибки SSH подключения
```bash
# Проверьте доступность
ping server_ip

# Проверьте SSH
ssh user@server_ip

# Проверьте порт
telnet server_ip 22
```

### ❌ Проблемы с зависимостями
```bash
# Переустановка
pip install --upgrade -r requirements.txt

# Очистка кэша
pip cache purge
pip install --no-cache-dir -r requirements.txt
```

### ❌ Проблемы с базой данных
```bash
# Пересоздание БД
rm -rf data/
# Перезапустите приложение
```

## 🛠️ Разработка

### Архитектура
- 🏗️ **MVC**: Модель-Вид-Контроллер
- 🗄️ **База данных**: SQLite с простой схемой
- 🎨 **Frontend**: Bootstrap 5 + Vanilla JS
- 🔄 **API**: RESTful endpoints

### Добавление функций
1. 📝 Создайте маршрут в `src/app.py`
2. 🎨 Добавьте HTML шаблон в `templates/`
3. 🗄️ Расширьте схему БД в `src/core/database.py`

### Тестирование
```bash
# Проверка работоспособности
curl http://127.0.0.1:5001/api/servers

# Проверка метрик
curl http://127.0.0.1:5001/api/metrics
```

## 📈 Мониторируемые метрики

- 🖥️ **CPU**: Загрузка процессора (%)
- 💾 **Memory**: Использование ОЗУ (%)
- 💿 **Disk**: Заполненность диска (%)
- ⏱️ **Uptime**: Время работы системы
- 🌐 **Network**: Статус сетевого подключения

## 🤝 Вклад в проект

1. 🍴 Сделайте Fork репозитория
2. 🌿 Создайте feature ветку
3. 💾 Зафиксируйте изменения
4. 📤 Отправьте Pull Request

## 📄 Лицензия

Проект распространяется под лицензией **MIT**. См. файл [LICENSE](LICENSE) для подробностей.

## 📞 Поддержка

При возникновении проблем:

1. 📋 Проверьте логи приложения
2. 🌐 Убедитесь в доступности серверов  
3. 🔐 Проверьте SSH настройки
4. 📖 Изучите документацию

---

**Сделано с ❤️ для мониторинга инфраструктуры**
