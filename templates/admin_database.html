<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î - –ê–¥–º–∏–Ω–∫–∞</title>
    <style>
        /* Same styles as other admin pages */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f8f9fa;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav {
            background: white;
            padding: 15px 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .nav a {
            margin-right: 20px;
            color: #007bff;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 4px;
            transition: background 0.3s;
        }
        .nav a:hover { background: #f8f9fa; }
        .main-content { padding: 30px; max-width: 1200px; margin: 0 auto; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .stat-number { font-size: 2rem; font-weight: bold; color: #667eea; }
        .stat-label { color: #6c757d; font-size: 0.9rem; }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
            transition: background 0.3s;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn:hover { opacity: 0.9; }
        .status-ok { color: #28a745; }
        .status-error { color: #dc3545; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üóÑÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö</h1>
        <a href="/admin/logout" style="color: white; text-decoration: none;">üö™ –í—ã—Ö–æ–¥</a>
    </div>

    <div class="nav">
        <a href="/admin">üìä Dashboard</a>
        <a href="/admin/servers">üñ•Ô∏è –°–µ—Ä–≤–µ—Ä—ã</a>
        <a href="/admin/database" style="background: #e9ecef;">üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</a>
        <a href="/">üè† –ì–ª–∞–≤–Ω–∞—è</a>
    </div>

    <div class="main-content">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">–°—Ç–∞—Ç—É—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</div>
                <div class="stat-number">
                    {% if stats.database_available %}
                        <span class="status-ok">‚úÖ –î–æ—Å—Ç—É–ø–Ω–∞</span>
                    {% else %}
                        <span class="status-error">‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–Ω–∞</span>
                    {% endif %}
                </div>
            </div>
            
            {% if stats.database_available %}
            <div class="stat-card">
                <div class="stat-label">–°–µ—Ä–≤–µ—Ä–æ–≤ –≤ –ë–î</div>
                <div class="stat-number">{{ stats.servers_count }}</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∞–ª–µ—Ä—Ç–æ–≤</div>
                <div class="stat-number">{{ stats.active_alerts }}</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ë–î</div>
                <div class="stat-number">{{ "%.2f"|format(stats.file_size / 1024) }} KB</div>
            </div>
            {% endif %}
        </div>

        {% if stats.database_available %}
        <div style="background: white; padding: 25px; border-radius: 10px; margin-bottom: 20px;">
            <h3>üîß –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö</h3>
            <button class="btn btn-primary" onclick="syncDatabase()">üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn btn-warning" onclick="exportData()">üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
            <button class="btn btn-success" onclick="cleanupOldData()">üßπ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö</button>
        </div>
        
        <div style="background: white; padding: 25px; border-radius: 10px;">
            <h3>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</h3>
            <p><strong>–§–∞–π–ª:</strong> {{ stats.database_file }}</p>
            <p><strong>–†–∞–∑–º–µ—Ä:</strong> {{ "%.2f"|format(stats.file_size / 1024) }} KB</p>
            <p><strong>–°–µ—Ä–≤–µ—Ä–æ–≤:</strong> {{ stats.servers_count }}</p>
            <p><strong>–ê–∫—Ç–∏–≤–Ω—ã—Ö –∞–ª–µ—Ä—Ç–æ–≤:</strong> {{ stats.active_alerts }}</p>
        </div>
        {% else %}
        <div style="background: #f8d7da; color: #721c24; padding: 25px; border-radius: 10px; border: 1px solid #f5c6cb;">
            <h3>‚ùå –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</h3>
            <p>{{ stats.error }}</p>
            <p>–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ JSON —Ñ–∞–π–ª–æ–≤.</p>
        </div>
        {% endif %}
    </div>

    <script>
        function syncDatabase() {
            fetch('/api/sync-database')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        alert('‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!');
                        location.reload();
                    } else {
                        alert('‚ùå –û—à–∏–±–∫–∞: ' + data.error);
                    }
                })
                .catch(error => {
                    alert('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error);
                });
        }

        function exportData() {
            alert('üì§ –§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö');
        }

        function cleanupOldData() {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (—Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π)?')) {
                alert('üßπ –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö');
            }
        }
    </script>
</body>
</html>
