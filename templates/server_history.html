<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò—Å—Ç–æ—Ä–∏—è {{ server.name }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .nav a { background: #007bff; color: white; padding: 10px 15px; text-decoration: none; border-radius: 5px; margin-left: 10px; }
        .chart-container { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px; height: 300px; position: relative; }
        .metrics-table { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f8f9fa; font-weight: bold; }
        .metric-value { font-weight: bold; }
        .metric-good { color: #28a745; }
        .metric-warning { color: #ffc107; }
        .metric-danger { color: #dc3545; }
        .no-data { text-align: center; padding: 40px; color: #6c757d; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìà –ò—Å—Ç–æ—Ä–∏—è –º–µ—Ç—Ä–∏–∫: {{ server.name }}</h1>
            <div>
                <a href="/admin">‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –∞–¥–º–∏–Ω–∫–µ</a>
                <a href="/servers">üñ•Ô∏è –°–µ—Ä–≤–µ—Ä—ã</a>
            </div>
        </div>

        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <strong>–°–µ—Ä–≤–µ—Ä:</strong> {{ server.name }} ({{ server.ip }}:{{ server.port }})<br>
            <strong>–°—Ç–∞—Ç—É—Å:</strong> {{ server.status }}<br>
            <strong>–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞:</strong> {{ server.last_check }}
        </div>

        {% if metrics %}
        <div class="chart-container">
            <h3>üìä –ì—Ä–∞—Ñ–∏–∫ –º–µ—Ç—Ä–∏–∫ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 –∑–∞–ø–∏—Å–µ–π)</h3>
            <canvas id="metricsChart" width="100%" height="200"></canvas>
        </div>

        <div class="metrics-table">
            <table>
                <thead>
                    <tr>
                        <th>–í—Ä–µ–º—è</th>
                        <th>CPU (%)</th>
                        <th>–ü–∞–º—è—Ç—å (%)</th>
                        <th>–î–∏—Å–∫ (%)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for metric in metrics %}
                    <tr>
                        <td>{{ metric.timestamp }}</td>
                        <td class="metric-value {% if metric.cpu_percent > 80 %}metric-danger{% elif metric.cpu_percent > 60 %}metric-warning{% else %}metric-good{% endif %}">
                            {{ "%.1f"|format(metric.cpu_percent) }}%
                        </td>
                        <td class="metric-value {% if metric.memory_percent > 85 %}metric-danger{% elif metric.memory_percent > 70 %}metric-warning{% else %}metric-good{% endif %}">
                            {{ "%.1f"|format(metric.memory_percent) }}%
                        </td>
                        <td class="metric-value {% if metric.disk_percent > 90 %}metric-danger{% elif metric.disk_percent > 80 %}metric-warning{% else %}metric-good{% endif %}">
                            {{ "%.1f"|format(metric.disk_percent) }}%
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="no-data">
            <h3>üì≠ –ò—Å—Ç–æ—Ä–∏—è –º–µ—Ç—Ä–∏–∫ –ø—É—Å—Ç–∞</h3>
            <p>–î–∞–Ω–Ω—ã–µ –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞</p>
        </div>
        {% endif %}
    </div>

    <script>
        // –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
        function drawChart() {
            const canvas = document.getElementById('metricsChart');
            if (!canvas || !{{ metrics|length }}) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = 200;
            
            // –î–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
            const data = [
                {% for metric in metrics|reverse %}
                {
                    cpu: {{ metric.cpu_percent }},
                    memory: {{ metric.memory_percent }},
                    disk: {{ metric.disk_percent }}
                },
                {% endfor %}
            ];
            
            if (data.length === 0) return;
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            const padding = 40;
            const chartWidth = width - padding * 2;
            const chartHeight = height - padding * 2;
            
            // –û—á–∏—Å—Ç–∫–∞
            ctx.clearRect(0, 0, width, height);
            
            // –°–µ—Ç–∫–∞
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 10; i++) {
                const y = padding + (i * chartHeight / 10);
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
            }
            
            // –õ–∏–Ω–∏–∏ –º–µ—Ç—Ä–∏–∫
            const colors = {cpu: '#007bff', memory: '#28a745', disk: '#ffc107'};
            
            Object.keys(colors).forEach(metric => {
                ctx.strokeStyle = colors[metric];
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                data.forEach((point, index) => {
                    const x = padding + (index * chartWidth / (data.length - 1));
                    const y = padding + chartHeight - (point[metric] * chartHeight / 100);
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                
                ctx.stroke();
            });
            
            // –õ–µ–≥–µ–Ω–¥–∞
            let legendX = padding;
            Object.keys(colors).forEach(metric => {
                ctx.fillStyle = colors[metric];
                ctx.fillRect(legendX, 10, 15, 15);
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.fillText(metric.toUpperCase(), legendX + 20, 22);
                legendX += 80;
            });
        }
        
        // –†–∏—Å—É–µ–º –≥—Ä–∞—Ñ–∏–∫ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
        window.addEventListener('load', drawChart);
    </script>
</body>
</html>
